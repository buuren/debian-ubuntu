function itemObject(a,b){this.json=a;this.index=b;this.fullPath=function(){return this.json.fullPath};this.name=function(){return this.json.displayName};this.date=function(){try{return new Date(this.json.lastmodified).f(_data.dateFormat)}catch(c){return new Date()}};this.size=function(){var c=this.json.size;var e=["Bytes","KB","MB","GB","TB"];if(c==0){return"n/a"}var d=parseInt(Math.floor(Math.log(c)/Math.log(1024)));return Math.round(c/Math.pow(1024,d),2)+" "+e[d]};this.id=function(){if(this.isDir()){return"folder_"+this.index}return"file_"+this.index};this.href=function(){return _data.webdavUrl+this.fullPath()};this.isDir=function(){return this.json.type=="Collection"};this.getObject=function(){return{fullPath:this.fullPath(),name:this.name(),date:this.date(),size:this.size(),id:this.id(),href:this.href(),isDir:this.isDir()}}}(function(a){a.nano=function(b,c){return b.replace(/\{([\w\.]*)\}/g,function(g,d){var e=d.split("."),f=c[e.shift()];a.each(e,function(){f=f[this]});return(f===null||f===undefined)?"":f})}})(jQuery);$(document).ready(function(){if(_data.webdavUrl==""||_data.webdavUrl==null){_data.webdavUrl=document.location.href.substring(0,document.location.href.lastIndexOf("/"))}if(_data.webdavUrlPrefix!=""&&_data.webdavUrlPrefix!=null){_data.webdavUrl+="/"+_data.webdavUrlPrefix}_data.msoSupportedtypes=";"+_data.accessTypes.replace(/,/g,";")+";"+_data.excelTypes.replace(/,/g,";")+";"+_data.outlookTypes.replace(/,/g,";")+";"+_data.powerTypes.replace(/,/g,";")+";"+_data.wordTypes.replace(/,/g,";")+";"+_data.frontPageTypes.replace(/,/g,";")+";";getFilesList(_data.currentDirectory,"get");$("a[id^='folder']").live("click",clickOnItem)});function refreshCurrentDir(){getFilesList(_data.currentDirectory,"get")}function getFilesList(a,b){if(b==null||b==undefined||b=="get"){_data.currentDirectory=a}$.blockUI.defaults.fadeIn=200;$.blockUI.defaults.fadeOut=0;$("#filesList").block({message:$("#waitMessage"),fadeIn:200,fadeOut:0});$.ajax({url:_data.serverUrl,data:{command:b,path:a,isAjax:"true"},dataType:"json",cache:false,success:filesListReceived,error:function(d,c){alert("Error : "+c)},complete:function(){$("#filesList").unblock()}})}function filesListReceived(a,b){_data.files=new Array();if(a.error!=null&&a.error.length>0){alert(a.error)}if(a.files!=null){$.each(a.files,function(c,d){_data.files[c]=new itemObject(d,c)})}renderFilesList()}function renderFilesList(){if(_data.files!=null){var a=null;$("#tableFilesList").empty();$("#tableFilesList").prepend($("#tableRowHeader").html());$("#tableFilesList").append("<tbody class='fileList_table'></tbody");a=$("#tableFilesList").find("tbody");if(_data.currentDirectory!="/"){addFileRow(getParentDirectoryItem(),a)}$.each(_data.files,function(b,c){addFileRow(c,a)});$("a[id^='file']").contextMenu(_data.contextMenuItems,{showOn:"both",beforeShow:beforeShowContextMenu});$("a[id^='folder']").contextMenu(_data.contextMenuItems,{showOn:"right",beforeShow:beforeShowContextMenu})}$("#currentDirecory").text(_data.currentDirectory)}function addFileRow(a,b){var c="#tableRowFile";if(a.isDir()){c="#tableRowFolder"}b.append($.nano($(c).html(),a.getObject()))}function getParentDirectoryItem(){return new itemObject({type:"Collection",fullPath:getParentPath(_data.currentDirectory),displayName:".."},"parent")}function getParentPath(b){var a=b;if(b.lastIndexOf("/")>=0){b=b.substring(0,b.lastIndexOf("/"))}if(b.indexOf("/")<0){return"/"+b}return b}function getIndexByElement(a){var c=a.id;try{return c.indexOf("file_")>=0?c.substring(c.indexOf("file_")+"file_".length):c.indexOf("folder_")>=0?c.substring(c.indexOf("folder_")+"folder_".length):-1}catch(b){}return -1}function getItemByIndex(a){if(a=="parent"){return getParentDirectoryItem()}if(a>=0&&a<_data.files.length){return _data.files[a]}return null}function getItemByElement(a){return getItemByIndex(getIndexByElement(a))}function file_get_ext(a){return typeof a!="undefined"?a.substring(a.lastIndexOf(".")+1,a.length).toLowerCase():false}function clickOnItem(){var a=getItemByElement(this);if(a!=null){if(a.isDir()){getFilesList(a.fullPath(),"get")}}else{alert("file not found")}return false}function beforeShowContextMenu(){var c=getItemByElement(this.target);var d=null;if(c!=null){if(c.isDir()){d=getMenuItem($(this.menu),"download");if(d!=null){$(d).addClass("context-menu-item-disabled")}if(c.index=="parent"){d=getMenuItem($(this.menu),"delete");if(d!=null){$(d).toggleClass("context-menu-item-disabled")}}}else{var b=_data.msoSupportedtypes.indexOf(";"+file_get_ext(c.name().toLowerCase())+";")!=-1;var a=_data.oooSupportedtypes.indexOf(";"+file_get_ext(c.name().toLowerCase())+";")!=-1;d=getMenuItem($(this.menu),"open");if(d!=null){$(d).removeClass("context-menu-item-disabled");if(!b&&!a){$(d).addClass("context-menu-item-disabled")}}d=getMenuItem($(this.menu),"openms");if(d!=null){$(d).removeClass("context-menu-item-disabled");if(!b){$(d).addClass("context-menu-item-disabled")}}d=getMenuItem($(this.menu),"openoo");if(d!=null){$(d).removeClass("context-menu-item-disabled");if(!a){$(d).toggleClass("context-menu-item-disabled")}}}}}function getMenuItem(b,a){return b.find("#"+a).get(0)}function openFile(a){_openFile(a,_data.modeToOpen)}function openFileMO(a){_data.modeToOpen=0;_openFile(a,_data.modeToOpen)}function openFileMS(a){_data.modeToOpen=2;_openFile(a,_data.modeToOpen)}function openFileOO(a){_data.modeToOpen=3;_openFile(a,_data.modeToOpen)}function _openFile(a,d){if(!a.isDir()){if(!EditDocumentInOffice(_data.webdavUrl+a.fullPath(),d)){var b=$("#OfficeLauncher").get(0);if(b==null){_data.fileToOpen=a;var c=_data.appletContents;c=c.replace("_data.accessTypes",_data.accessTypes).replace("_data.excelTypes",_data.excelTypes).replace("_data.outlookTypes",_data.outlookTypes).replace("_data.powerTypes",_data.powerTypes).replace("_data.wordTypes",_data.wordTypes).replace("_data.frontPageTypes",_data.frontPageTypes);$("#appletHolder").empty();$("#appletHolder").wrapInner(c)}else{if(_data.pathDetected){b.openDocument(_data.webdavUrl+a.fullPath(),d)}else{onOfficePathNotDetected()}}}}else{getFilesList(a.fullPath(),"get")}}function downloadFile(a){document.location=_data.webdavUrl+a.fullPath()}function deleteFile(a){if(confirm("Are you sure you want to delete '"+a.name()+"'?")){getFilesList(a.fullPath(),"delete")}}function cancelBrowseDialog(){$("#filesList").unblock()}function showBrowseDialog(a){var b=$("#OfficeLauncher").get(0);if(_data.fileToOpen!=null){b.openDocument(_data.webdavUrl+_data.fileToOpen.fullPath(),4);if(b.getDetectedOfficeType()>0){_data.fileToOpen=null;$("#filesList").unblock()}}}function onLauncherInited(a){}function onOfficePathDetected(a){_data.pathDetected=true;if(_data.fileToOpen!=null){openFile(_data.fileToOpen);_data.fileToOpen=null}}function onOfficePathNotDetected(){_data.pathDetected=false;$("#filesList").block({message:$("#selectProgrammToOpen"),fadeIn:200,fadeOut:200})}function Browseris(){var f=navigator.userAgent.toLowerCase();this.osver=1;if(f){var b=f.substring(f.indexOf("windows ")+11);this.osver=parseFloat(b)}this.major=parseInt(navigator.appVersion);this.nav=((f.indexOf("mozilla")!=-1)&&((f.indexOf("spoofer")==-1)&&(f.indexOf("compatible")==-1)));this.nav6=this.nav&&(this.major==5);this.nav6up=this.nav&&(this.major>=5);this.nav7up=false;if(this.nav6up){var c=f.indexOf("netscape/");if(c>=0){this.nav7up=parseInt(f.substring(c+9))>=7}}this.ie=(f.indexOf("msie")!=-1);this.aol=this.ie&&f.indexOf(" aol ")!=-1;if(this.ie){var g=f.substring(f.indexOf("msie ")+5);this.iever=parseInt(g);this.verIEFull=parseFloat(g)}else{this.iever=0}this.ie4up=this.ie&&(this.major>=4);this.ie5up=this.ie&&(this.iever>=5);this.ie55up=this.ie&&(this.verIEFull>=5.5);this.ie6up=this.ie&&(this.iever>=6);this.ie7down=this.ie&&(this.iever<=7);this.ie7up=this.ie&&(this.iever>=7);this.ie8standard=this.ie&&document.documentMode&&(document.documentMode==8);this.winnt=((f.indexOf("winnt")!=-1)||(f.indexOf("windows nt")!=-1));this.win32=((this.major>=4)&&(navigator.platform=="Win32"))||(f.indexOf("win32")!=-1)||(f.indexOf("32bit")!=-1);this.win64bit=(f.indexOf("win64")!=-1)||(f.indexOf("wow64")!=-1);this.win=this.winnt||this.win32||this.win64bit;this.mac=(f.indexOf("mac")!=-1);this.w3c=this.nav6up;this.safari=(f.indexOf("webkit")!=-1);this.safari125up=false;this.safari3up=false;if(this.safari&&this.major>=5){var c=f.indexOf("webkit/");if(c>=0){this.safari125up=parseInt(f.substring(c+7))>=125}var a=f.indexOf("version/");if(a>=0){this.safari3up=parseInt(f.substring(a+8))>=3}}this.firefox=this.nav&&(f.indexOf("firefox")!=-1);this.firefox3up=false;this.firefox36up=false;if(this.firefox&&this.major>=5){var d=f.indexOf("firefox/");if(d>=0){var e=f.substring(d+8);this.firefox3up=parseInt(e)>=3;this.firefox36up=parseFloat(e)>=3.6}}}var browseris=new Browseris();function IsSupportedMacBrowser(){return browseris.mac&&(browseris.firefox3up||browseris.safari3up)}function IsBrowserPluginInstalled(a){return navigator.mimeTypes&&navigator.mimeTypes[a]&&navigator.mimeTypes[a].enabledPlugin}function IsMacPluginInstalled(){var a=IsBrowserPluginInstalled("application/x-sharepoint-webkit");var b=IsBrowserPluginInstalled("application/x-sharepoint");if(browseris.safari3up&&a){return true}return b}function CreateMacPlugin(){var b=null;if(IsSupportedMacBrowser()){b=document.getElementById("macSharePointPlugin");if(b==null&&IsMacPluginInstalled()){var a=null;if(browseris.safari3up&&IsBrowserPluginInstalled("application/x-sharepoint-webkit")){a="application/x-sharepoint-webkit"}else{a="application/x-sharepoint"}var c=document.createElement("object");c.id="macSharePointPlugin";c.type=a;c.width=0;c.height=0;c.style.setProperty("visibility","hidden","");document.body.appendChild(c);b=document.getElementById("macSharePointPlugin")}}return b}function IsSupportedFirefoxOnWin(){return(browseris.winnt||browseris.win32||browseris.win64bit)&&browseris.firefox3up}function CreateFirefoxOnWindowsPlugin(){var a=null;if(IsSupportedFirefoxOnWin()){try{a=document.getElementById("winFirefoxPlugin");if(!a&&IsBrowserPluginInstalled("application/x-sharepoint")){var c=document.createElement("object");c.id="winFirefoxPlugin";c.type="application/x-sharepoint";c.width=0;c.height=0;c.style.setProperty("visibility","hidden","");document.body.appendChild(c);a=document.getElementById("winFirefoxPlugin")}}catch(b){a=null}}return a}function EditDocumentInOffice(a,b){if(b==0){if(!EditDocumentInMSOffice(a)){return EditDocumentInOOo(a)}return true}if(b==1){if(!EditDocumentInOOo(a)){return EditDocumentInMSOffice(a)}return true}if(b==2){return EditDocumentInMSOffice(a)}if(b==3){return EditDocumentInOOo(a)}return false}function EditDocumentInMSOffice(b){var a=null;if(window.ActiveXObject){try{var a=new ActiveXObject("SharePoint.OpenDocuments.3")}catch(d){try{var a=new ActiveXObject("SharePoint.OpenDocuments.2")}catch(d){try{var a=new ActiveXObject("SharePoint.OpenDocuments.1")}catch(d){}}}}else{if(browseris){try{if(IsSupportedMacBrowser()){var c=CreateMacPlugin();if(c!=null){a=c}}else{if(IsSupportedFirefoxOnWin()){var c=CreateFirefoxOnWindowsPlugin();if(c!=null){a=c}}}}catch(d){}}}try{return a.EditDocument(b)}catch(d){return false}}function EditDocumentInOOo(a){if(window.ActiveXObject){try{var d=new ActiveXObject("com.sun.star.ServiceManager");if(d){var c=d.createInstance("com.sun.star.frame.Desktop");if(c){return c.LoadComponentFromURL(a,"_blank",0,[])}}return false}catch(b){return false}}return false};